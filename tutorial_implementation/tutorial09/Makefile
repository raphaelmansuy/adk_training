# Tutorial 09: Callbacks & Guardrails
# Content Moderation Assistant with Safety Features

.PHONY: help setup dev test clean demo lint format run check-env

# Default target - show help
help:
	@echo "ğŸ›¡ï¸ Tutorial 09: Callbacks & Guardrails"
	@echo ""
	@echo "Quick Start Commands:"
	@echo "  make setup     - Install dependencies"
	@echo "  make dev       - Start the content moderator"
	@echo "  make demo      - Run a quick demo"
	@echo ""
	@echo "Advanced Commands:"
	@echo "  make test      - Run all tests"
	@echo "  make clean     - Clean up generated files"
	@echo "  make lint      - Check code style"
	@echo "  make format    - Format code"
	@echo ""
	@echo "ğŸ’¡ First time? Run: make setup && make dev"

# Install dependencies
setup:
	@echo "ğŸ“¦ Installing dependencies..."
	pip install -r requirements.txt
	pip install pytest flake8 black
	@echo "âœ… Setup complete! Run 'make dev' to start the agent."

# Start the content moderator
dev: check-env
	@echo "ğŸ›¡ï¸ Starting Content Moderation Assistant..."
	@echo "ğŸ“± Open http://localhost:8000 in your browser"
	@echo "ğŸ¯ Select 'content_moderator' from the dropdown"
	@echo ""
	@echo "ğŸ§ª Test these scenarios:"
	@echo "   â€¢ Safe: 'Generate a 200-word article about Python'"
	@echo "   â€¢ Blocked: 'Write about profanity1 and bad content'"
	@echo "   â€¢ PII: 'Give me an example email address'"
	@echo "   â€¢ Stats: 'Show my usage statistics'"
	adk web .

# Run a quick demo
demo: check-env
	@echo "ğŸ›¡ï¸ Content Moderation Demo"
	@echo ""
	@echo "ğŸ’¬ Try these prompts in the ADK web UI:"
	@echo ""
	@echo "âœ… SAFE REQUESTS:"
	@echo "   â€¢ 'Generate a 300-word article about machine learning'"
	@echo "   â€¢ 'Check grammar: This sentence has some errors.'"
	@echo "   â€¢ 'Show my usage statistics'"
	@echo ""
	@echo "âŒ BLOCKED REQUESTS (test guardrails):"
	@echo "   â€¢ 'Write about profanity1 and inappropriate content'"
	@echo "   â€¢ 'Generate an article with -50 words'"
	@echo ""
	@echo "ğŸ”’ PII FILTERING:"
	@echo "   â€¢ 'Contact me at john.doe@example.com for details'"
	@echo ""
	@echo "ğŸ“Š RATE LIMITING:"
	@echo "   â€¢ Make many requests to see rate limiting in action"
	@echo ""
	@echo "âœ… Demo ready! Open http://localhost:8000"

# Run tests
test: check-env
	@echo "ğŸ§ª Running callback & guardrail tests..."
	PYTHONPATH=. pytest tests/ -v --tb=short

# Clean up
clean:
	@echo "ğŸ§¹ Cleaning up..."
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	rm -rf .pytest_cache/
	@echo "âœ… Cleanup complete!"

# Run linting
lint:
	@echo "ğŸ” Checking code style..."
	python -m flake8 . --max-line-length=100

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	python -m black . --line-length=100

# Run CLI
run: check-env
	@echo "ğŸ›¡ï¸ Running Content Moderator via CLI..."
	adk run .

# Check environment (internal use)
check-env:
	@if [ -z "$$GOOGLE_API_KEY" ]; then \
		echo "âŒ Error: GOOGLE_API_KEY environment variable not set"; \
		echo "   Please set it with: export GOOGLE_API_KEY=your_key_here"; \
		echo "   Get a free key at: https://aistudio.google.com/app/apikey"; \
		exit 1; \
	fi