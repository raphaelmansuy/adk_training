.PHONY: setup clean test dev help docker-up docker-down

help:
	@echo ""
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘  Custom Session Services TIL - Redis Session Storage Demo     â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo ""
	@echo "ðŸŽ¯ QUICK START:"
	@echo "   make setup          Install dependencies"
	@echo "   make dev            Start ADK web with Redis sessions"
	@echo "   make test           Run unit tests"
	@echo ""
	@echo "ðŸ³ DOCKER:"
	@echo "   make docker-up      Start Redis container (port 6379)"
	@echo "   make docker-down    Stop containers"
	@echo ""
	@echo "ðŸ§¹ CLEANUP:"
	@echo "   make clean          Remove cache files"
	@echo ""
	@echo "ðŸ“– FULL GUIDE:"
	@echo "   1. make setup"
	@echo "   2. make docker-up"
	@echo "   3. make dev"
	@echo "   4. Open http://127.0.0.1:8000"
	@echo "   5. Select: custom_session_agent"
	@echo ""
	@echo "âœ¨ Try sending: 'Write me a poem'"
	@echo "   Then refresh the browser to test persistence!"
	@echo ""

setup:
	@echo "ðŸ“¦ Installing dependencies..."
	pip install -r requirements.txt
	pip install -e .
	@echo "âœ… Done!"

docker-up:
	@echo "ðŸ³ Starting Redis..."
	docker-compose up -d redis
	@echo "â³ Waiting for Redis to be ready..."
	sleep 2
	redis-cli ping 2>/dev/null || sleep 2
	@echo "âœ… Redis ready at redis://localhost:6379"

docker-down:
	@echo "ðŸ›‘ Stopping Redis..."
	docker-compose down
	@echo "âœ… Stopped"

dev: docker-up
	@echo ""
	@echo "ðŸš€ Starting ADK web interface..."
	@echo "   Agent: custom_session_agent"
	@echo "   Backend: Redis (redis://localhost:6379)"
	@echo "   URL: http://127.0.0.1:8000"
	@echo ""
	python -m custom_session_agent web --session_service_uri=redis://localhost:6379

test:
	@echo "ðŸ§ª Running tests..."
	pytest tests/ -v --tb=short
	@echo "âœ… Tests complete!"

clean:
	@echo "ðŸ§¹ Cleaning..."
	find . -type d -name __pycache__ -exec rm -rf {} + 2>/dev/null || true
	find . -type f -name "*.pyc" -delete
	find . -type d -name ".pytest_cache" -delete
	find . -type d -name "*.egg-info" -delete
	@echo "âœ… Clean!"
